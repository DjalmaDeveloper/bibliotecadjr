name: Deploy frontend to Cloudflare Pages
on:
  push:
    branches: ["main"]

jobs:
  deploy-frontend:
    name: Deploy frontend (Cloudflare Pages)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create 404.html (for SPA routing)
        run: |
          mkdir -p frontend
          cat > frontend/404.html <<'EOF'
          <!DOCTYPE html>
          <html>
            <head>
              <meta charset="utf-8">
              <meta http-equiv="refresh" content="0;URL=/">
              <meta name="viewport" content="width=device-width, initial-scale=1">
              <title>Redirecting...</title>
            </head>
            <body>
              <p>Redirecting...</p>
            </body>
          </html>
          EOF

      - name: Deploy to Cloudflare Pages
        uses: cloudflare/wrangler-action@v3
        with:
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          # Deploy the 'frontend' directory. Update --project-name if your Cloudflare Pages project uses another name.
          command: pages deploy ./frontend --project-name=bibliotecadjr